<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #000; color: white; text-align: center; font-family: sans-serif; display: flex; flex-direction: column; justify-content: center; height: 100vh; margin: 0; }
        .btn { width: 80%; padding: 20px; margin: 10px auto; border-radius: 15px; border: none; font-size: 18px; font-weight: bold; }
        .client { background: #2481cc; color: white; }
        .master { background: transparent; border: 2px solid #2481cc; color: #2481cc; }
        #loader { font-size: 18px; }
    </style>
</head>
<body>
    <div id="loader">üêæ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...</div>

    <div id="menu" style="display:none;">
        <h2>PETGroom –ê–ª–º–∞—Ç—ã</h2>
        <p>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É —Ä–æ–ª—å:</p>
        <button class="btn client" onclick="location.href='client.html'">–Ø –ø—Ä–∏–≤–µ–ª –ø–∏—Ç–æ–º—Ü–∞</button>
        <button class="btn master" onclick="regMaster()">–Ø –º–∞—Å—Ç–µ—Ä (–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        const _supabase = supabase.createClient('https://uplcrgnxkafcxejwuggx.supabase.co', 'sb_publishable_SDlNlU_Nco34DHqTS0DasA_5jQqyiSF');

        async function checkRole() {
            const userId = tg.initDataUnsafe.user.id;
            const { data } = await _supabase.from('masters').select('telegram_id').eq('telegram_id', userId).single();

            document.getElementById('loader').style.display = 'none';
            if (data) {
                location.href = 'admin.html';
            } else {
                document.getElementById('menu').style.display = 'block';
            }
        }

        function regMaster() {
            // –°–∏–≥–Ω–∞–ª –±–æ—Ç—É –Ω–∞—á–∞—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
            tg.sendData(JSON.stringify({action: "start_master_registration"}));
            tg.close();
        }
        checkRole();
    </script>
</body>
</html>