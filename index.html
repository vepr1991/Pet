<!DOCTYPE html>
<html>
<head>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #000; color: white; text-align: center; font-family: sans-serif; display: flex; flex-direction: column; justify-content: center; height: 100vh; margin: 0; }
    </style>
</head>
<body>
    <div id="loader">üêæ –ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const SUPABASE_URL = 'https://uplcrgnxkafcxejwuggx.supabase.co';
        const SUPABASE_KEY = 'sb_publishable_SDlNlU_Nco34DHqTS0DasA_5jQqyiSF';
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function route() {
            const user = tg.initDataUnsafe.user;
            const startParam = tg.initDataUnsafe.start_param; // ID –º–∞—Å—Ç–µ—Ä–∞ –∏–∑ —Å—Å—ã–ª–∫–∏
            const ADMIN_ID = 8441802462; // –í–∞—à ID

            // 1. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –∑–∞—à–µ–ª –ø–æ —Å—Å—ã–ª–∫–µ –º–∞—Å—Ç–µ—Ä–∞ (?startapp=ID)
            if (startParam) {
                location.href = `client.html?master=${startParam}`;
                return;
            }

            // 2. –ï—Å–ª–∏ –∑–∞—à–ª–∏ –í–´ (–ì–ª–∞–≤–Ω—ã–π –ê–¥–º–∏–Ω)
            if (user && user.id === ADMIN_ID) {
                location.href = 'admin.html';
                return;
            }

            // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –º–∞—Å—Ç–µ—Ä –ª–∏ —ç—Ç–æ
            const { data } = await _supabase.from('masters').select('telegram_id').eq('telegram_id', user.id).maybeSingle();

            if (data) {
                location.href = 'admin.html';
            } else {
                // –ï—Å–ª–∏ –Ω–æ–≤—ã–π —á–µ–ª–æ–≤–µ–∫ –±–µ–∑ —Å—Å—ã–ª–∫–∏ - –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å—Ç–∞—Ç—å –º–∞—Å—Ç–µ—Ä–æ–º
                location.href = 'client.html'; // –ü–æ –¥–µ—Ñ–æ–ª—Ç—É –Ω–∞ –æ–±—â—É—é –∑–∞–ø–∏—Å—å
            }
        }
        route();
    </script>
</body>
</html>